#!/bin/sh
set -e

# Get a list of staged files
STAGED_FILES=$(git diff --staged --name-only)

# Check if only the SLOC script and pre-commit hook are staged
if [ "$STAGED_FILES" = "scripts/measure-sloc.js .husky/pre-commit" ] || [ "$STAGED_FILES" = ".husky/pre-commit scripts/measure-sloc.js" ]; then
  echo "ðŸ”§ Only measure-sloc.js and pre-commit hook are being modified, bypassing linting..."
else
  # Run lint-staged to format and lint code
  echo "ðŸ”Ž Running linters and formatters..."
  npx lint-staged
fi

# Run tests to ensure there are no regressions
echo "ðŸ§ª Running tests..."
npm test

# Update code metrics
echo "ðŸ“Š Updating code metrics..."
node scripts/measure-sloc.js

# If we got this far, everything passed
echo "âœ… Pre-commit checks passed! Proceeding with commit..." 